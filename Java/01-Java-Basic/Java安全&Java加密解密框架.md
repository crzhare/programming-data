# Java安全

Java语言有以下机制确保安全：

1. 语言涉及特性(对数组越界进行检查、没有不受检查的类型转换、无指针算法)。
2. 访问控制机制，用于控制代码能够执行的操作(比如文件，网络访问等)。
3. 代码签名，利用该特性，代码的作者就能够用标准的加密算法来认证Java代码，以及代码手否被篡改过。

## 1 类加载器、字节码校验

类加载器将来加载到虚拟机中的时候会检查类的完整性。

当类加载器将加载到的字节码传递给java虚拟机时，这些字节码首先要接受**校验器(verifier)**的校验,校验器负责检查哪些指令无法执行的明显有破坏性的操作，除了系统类外，所有的类都要被检查。

检查的范围一般包括：

- 变量要在使用前进行初始化
- 方法调用与对象引用类型之间要匹配
- 访问私有变量和方法的规则没有被破坏
- 对本地变量的访问都要落在运行时堆栈内
- 运行时堆栈没有溢出

编译通过的代码，在编译为字节码后，如果被串改，也会被java虚拟机发现。

## 2 安全管理器与访问权限

一旦某个类被加载到虚拟机中，并由校验器检查过后，java平台的第二种安全机制就会启动，这个机制就是**安全管理器**，安全管理器检查的操作包括：

- 创建一个新的类加载器
- 退出虚拟机
- 使用反射访问另一个类的成员
- 访问本地文件
- 打开socket连接
- 启动打印作业
- 访问系统剪贴板
- 访问AWT事件队列
- 打开一个顶层窗口

比如Runtime类的Exit方法会调用安全管理器的checkExit方法：

```java
public void exit(int status) {
    SecurityManager security = System.getSecurityManager();
    if (security != null) {
        security.checkExit(status);
    }
    Shutdown.exit(status);
}
```

## 3 用户认证

JAAS(Java Authentication and Authorization Service)

## 4 数据签名

要确定一份代码是否安全，首先要搞清楚两个问题：

1. 这份代码来自哪里
2. 这份代码是否被篡改过

**消息摘要**：

- MD5
- SHA1

实现类，java.security.MessageDigest

**消息签名**：

- 对称加密： DES、3DES、AES、
- 不对称加密：RSA

**签名校验**：

- keytool使用，生成公钥与私钥
- CA证书与证书链，校验公钥是否正规
- 代码签名

## 引用

- 《java加密与解密的艺术构建安全》
- 《Java核心技术》
